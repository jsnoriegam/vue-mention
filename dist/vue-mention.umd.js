var re=Object.defineProperty,le=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var O=(a,d,t)=>d in a?re(a,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[d]=t,H=(a,d)=>{for(var t in d||(d={}))se.call(d,t)&&O(a,t,d[t]);if(A)for(var t of A(d))de.call(d,t)&&O(a,t,d[t]);return a},W=(a,d)=>le(a,ae(d));(function(a,d){typeof exports=="object"&&typeof module!="undefined"?d(exports,require("floating-vue"),require("vue")):typeof define=="function"&&define.amd?define(["exports","floating-vue","vue"],d):(a=typeof globalThis!="undefined"?globalThis:a||self,d(a.VueMention={},a.FloatingVue,a.Vue))})(this,function(a,d,t){"use strict";var M={exports:{}};(function(n){(function(){var u=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],r=typeof window!="undefined",y=r&&window.mozInnerScreenX!=null;function v(p,S,f){if(!r)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=f&&f.debug||!1;if(s){var o=document.querySelector("#input-textarea-caret-position-mirror-div");o&&o.parentNode.removeChild(o)}var h=document.createElement("div");h.id="input-textarea-caret-position-mirror-div",document.body.appendChild(h);var g=h.style,m=window.getComputedStyle?window.getComputedStyle(p):p.currentStyle,C=p.nodeName==="INPUT";g.whiteSpace="pre-wrap",C||(g.wordWrap="break-word"),g.position="absolute",s||(g.visibility="hidden"),u.forEach(function(k){C&&k==="lineHeight"?g.lineHeight=m.height:g[k]=m[k]}),y?p.scrollHeight>parseInt(m.height)&&(g.overflowY="scroll"):g.overflow="hidden",h.textContent=p.value.substring(0,S),C&&(h.textContent=h.textContent.replace(/\s/g,"\xA0"));var w=document.createElement("span");w.textContent=p.value.substring(S)||".",h.appendChild(w);var I={top:w.offsetTop+parseInt(m.borderTopWidth),left:w.offsetLeft+parseInt(m.borderLeftWidth),height:parseInt(m.lineHeight)};return s?w.style.backgroundColor="#aaa":document.body.removeChild(h),I}n.exports=v})()})(M);var q=M.exports,R=(n,u)=>{const r=n.__vccOpts||n;for(const[y,v]of u)r[y]=v;return r};d.options.themes.mentionable={$extend:"dropdown",placement:"top-start",arrowPadding:6,arrowOverflow:!1};const U=t.defineComponent({components:{VDropdown:d.Dropdown},inheritAttrs:!1,props:{keys:{type:Array,required:!0},items:{type:Array,default:()=>[]},omitKey:{type:Boolean,default:!1},filteringDisabled:{type:Boolean,default:!1},insertSpace:{type:Boolean,default:!1},mapInsert:{type:Function,default:null},limit:{type:Number,default:8},theme:{type:String,default:"mentionable"},caretHeight:{type:Number,default:0}},emits:["search","open","close","apply"],setup(n,{emit:u}){const r=t.ref(null);let y;const v=t.ref(null),p=t.ref(null);t.watch(p,(e,i)=>{e&&u("search",e,i)});const S=t.computed(()=>{if(!p.value||n.filteringDisabled)return n.items;const e=p.value.toLowerCase();return n.items.filter(i=>{let l;if(i.searchText)l=i.searchText;else if(i.label)l=i.label;else{l="";for(const c in i)l+=i[c]}return l.toLowerCase().includes(e)})}),f=t.computed(()=>S.value.slice(0,n.limit)),s=t.ref(0);t.watch(f,()=>{s.value=0},{deep:!0});let o;const h=t.ref(null);function g(){var e,i;return(i=(e=h.value.querySelector("input"))!=null?e:h.value.querySelector("textarea"))!=null?i:h.value.querySelector('[contenteditable="true"]')}t.onMounted(()=>{o=g(),m()}),t.onUpdated(()=>{const e=g();e!==o&&(C(),o=e,m())}),t.onUnmounted(()=>{C()});function m(){o&&(o.addEventListener("input",w),o.addEventListener("keydown",k),o.addEventListener("keyup",N),o.addEventListener("scroll",K),o.addEventListener("blur",I))}function C(){o&&(o.removeEventListener("input",w),o.removeEventListener("keydown",k),o.removeEventListener("keyup",N),o.removeEventListener("scroll",K),o.removeEventListener("blur",I))}function w(){ee()}function I(){x()}function k(e){r.value&&(e.key==="ArrowDown"&&(s.value++,s.value>=f.value.length&&(s.value=0),E(e)),e.key==="ArrowUp"&&(s.value--,s.value<0&&(s.value=f.value.length-1),E(e)),(e.key==="Enter"||e.key==="Tab")&&f.value.length>0&&(z(s.value),E(e)),e.key==="Escape"&&(x(),E(e)))}let T=null;function N(e){T&&e.key===T&&E(e),T=null}function E(e){e.preventDefault(),e.stopPropagation(),T=e.key}function K(){V()}function J(){return o.isContentEditable?window.getSelection().anchorOffset:o.selectionStart}function Q(e){t.nextTick(()=>{o.selectionEnd=e})}function $(){return o.isContentEditable?window.getSelection().anchorNode.textContent:o.value}function Z(e){o.value=e,D("input")}function D(e){o.dispatchEvent(new Event(e))}let B=null;function ee(){const e=J();if(e>=0){const{key:i,keyIndex:l}=te(e),c=B=ne(e,l);if(c!=null)return oe(i,l),p.value=c,!0}return x(),!1}function te(e){const[i]=n.keys.map(l=>({key:l,keyIndex:$().lastIndexOf(l,e-1)})).sort((l,c)=>c.keyIndex-l.keyIndex);return i}function ne(e,i){if(i!==-1){const l=$().substring(i+1,e);if(!/[\s\(\)\{\}\[\]]/.test(l))return l}return null}const b=t.ref(null);function V(){if(r.value){if(o.isContentEditable){const e=window.getSelection().getRangeAt(0).getBoundingClientRect(),i=o.getBoundingClientRect();b.value={left:e.left-i.left,top:e.top-i.top,height:e.height}}else b.value=q(o,y);b.value.top-=o.scrollTop,n.caretHeight?b.value.height=n.caretHeight:isNaN(b.value.height)&&(b.value.height=16)}}function oe(e,i){r.value!==e&&(r.value=e,y=i,V(),s.value=0,u("open",r.value))}function x(){r.value!=null&&(v.value=r.value,r.value=null,u("close",v.value))}function z(e){const i=f.value[e],l=(n.omitKey?"":r.value)+String(n.mapInsert?n.mapInsert(i,r.value):i.value)+(n.insertSpace?" ":"");if(o.isContentEditable){const c=window.getSelection().getRangeAt(0);c.setStart(c.startContainer,c.startOffset-r.value.length-(B?B.length:0)),c.deleteContents(),c.insertNode(document.createTextNode(l)),c.setStart(c.endContainer,c.endOffset),D("input")}else Z(ie($()||"",p.value,l,y)),Q(y+l.length);u("apply",i,r.value,l),x()}function ie(e,i,l,c){return e.slice(0,c)+l+e.slice(c+i.length+1,e.length)}return{el:h,currentKey:r,oldKey:v,caretPosition:b,displayedItems:f,selectedIndex:s,applyMention:z}}}),F={key:0},j=t.createTextVNode(" No result "),X=["onMouseover","onMousedown"];function Y(n,u,r,y,v,p){const S=t.resolveComponent("VDropdown");return t.openBlock(),t.createElementBlock("div",{ref:"el",class:t.normalizeClass(["mentionable",n.$attrs.class]),style:{position:"relative"}},[t.renderSlot(n.$slots,"default"),t.createVNode(S,t.mergeProps({ref:"popper"},W(H({},n.$attrs),{class:void 0}),{shown:!!n.currentKey,triggers:[],"auto-hide":!1,theme:n.theme,class:"popper",style:[{position:"absolute"},n.caretPosition?{top:`${n.caretPosition.top}px`,left:`${n.caretPosition.left}px`}:{}]}),{popper:t.withCtx(()=>[n.displayedItems.length?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:1},t.renderList(n.displayedItems,(f,s)=>(t.openBlock(),t.createElementBlock("div",{key:s,class:t.normalizeClass(["mention-item",{"mention-selected":n.selectedIndex===s}]),onMouseover:o=>n.selectedIndex=s,onMousedown:o=>n.applyMention(s)},[t.renderSlot(n.$slots,`item-${n.currentKey||n.oldKey}`,{item:f,index:s},()=>[t.renderSlot(n.$slots,"item",{item:f,index:s},()=>[t.createTextVNode(t.toDisplayString(f.label||f.value),1)])])],42,X))),128)):(t.openBlock(),t.createElementBlock("div",F,[t.renderSlot(n.$slots,"no-result",{},()=>[j])]))]),default:t.withCtx(()=>[t.createElementVNode("div",{style:t.normalizeStyle(n.caretPosition?{height:`${n.caretPosition.height}px`}:{})},null,4)]),_:3},16,["shown","theme","style"])],2)}var L=R(U,[["render",Y]]);function _(n,u){n.component(`${u}mentionable`,L),n.component(`${u}Mentionable`,L)}function P(n,u){const r=Object.assign({},{installComponents:!0,componentsPrefix:""},u);r.installComponents&&_(n,r.componentsPrefix)}const G={version:"2.0.0-alpha.4",install:P};a.Mentionable=L,a.default=G,a.install=P,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
